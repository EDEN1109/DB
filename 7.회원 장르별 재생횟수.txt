SET FEEDBACK OFF

TTITLE '회원별 음원 재생정보'
COLUMN USID HEADING '회원ID'
COLUMN NAME HEADING '이름'
COLUMN GENRE HEADING '음원|장르'
COLUMN PNUM HEADING '재생|횟수'
BREAK ON USID ON NAME

WITH GENRES AS (SELECT DISTINCT GENRE FROM SOUNDTRACK),
CPNUM AS (SELECT USER_ID, GENRE AS GOFP, COUNT(*) AS PNUM
		FROM PLAY, SOUNDTRACK
		WHERE PLAY.PLAY_NUM = SOUNDTRACK.NUM
		GROUP BY USER_ID, SOUNDTRACK.GENRE)
SELECT US.USER_ID AS USID, US.NAME AS NAME, NVL(GENRE,'재생 정보가 없습니다.') AS GENRE, NVL(PNUM,0) AS PNUM
FROM MUSICAPP_USER US, CPNUM, GENRES
WHERE US.USER_ID = CPNUM.USER_ID(+)
AND US.USER_ID = '&회원아이디'
AND CPNUM.GOFP = GENRES.GENRE(+)
ORDER BY USID, PNUM DESC
/

TTITLE OFF
CLEAR COLUMNS
CLEAR BREAK