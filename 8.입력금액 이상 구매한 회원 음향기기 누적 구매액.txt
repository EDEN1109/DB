SET FEEDBACK OFF

TTITLE '회원별 음향기기 누적 구매금액' 
COLUMN BUYERID HEADING '회원|아이디'
COLUMN NAME HEADING '회원명'
COLUMN PSUM HEADING '총|구매금액' FORMAT 999,999,999

WITH P_INFO AS (SELECT USER_ID, SUM(PRODUCT.PRICE*PURCHASE_NUM) AS PSUM
		FROM PRODUCT, PURCHASE
		WHERE PURCHASE.PURCHASE_PRODUCT = PRODUCT.NUM
		GROUP BY USER_ID)
SELECT US.USER_ID AS BUYERID, NAME, NVL(PSUM,0) AS PSUM
FROM MUSICAPP_USER US, P_INFO
WHERE US.USER_ID = P_INFO.USER_ID(+)
AND NVL(PSUM,0) >= &구매액
ORDER BY PSUM DESC
/

TTITLE OFF
CLEAR COLUMNS