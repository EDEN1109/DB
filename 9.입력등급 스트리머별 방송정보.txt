SET FEEDBACK OFF

TTITLE  '스트리머 방송정보'
COLUMN SID HEADING '스트리머ID'
COLUMN STIME HEADING '방송시간|합계' FORMAT 999,999,990.00
COLUMN SNUM HEADING '방송|횟수'
COLUMN FVNUM HEADING '시청자|합계' FORMAT 999,999,999,999
COLUMN DDATE HEADING '등급|결정일시'
COLUMN RANK HEADING '등급'

WITH STREAMER_INFO AS (SELECT STREAMER_ID,SUM(ROUND((END_T-START_T)*24*60*60)/3600) AS STIMES, COUNT(*) AS SNUMS  
			FROM STREAMING 
			GROUP BY STREAMER_ID), 
			VIEW_INFO AS (SELECT VIEW_NUM, COUNT(*) AS VNUMS 
			FROM VIEWING 
			GROUP BY VIEW_NUM), 
			VIEWS AS (SELECT STREAMER_ID, SUM(VNUMS) AS VNUM
			FROM STREAMING, VIEW_INFO 
			WHERE VIEW_INFO.VIEW_NUM = STREAMING.NUM
			GROUP BY STREAMER_ID),
DECIDE_INFO AS (SELECT STREAMER_ID, MAX(DECIDE_DATE) KEEP (DENSE_RANK LAST ORDER BY DECIDE_DATE) AS DDATE, MAX(RANK_CATEGORY) KEEP (DENSE_RANK LAST ORDER BY DECIDE_DATE) AS RANK
		FROM DECIDE
		GROUP BY STREAMER_ID)
SELECT STREAMER.STREAMER_ID AS SID, NVL(STIMES,0) AS STIME, NVL(SNUMS,0) AS SNUM, NVL(VNUM,0) AS FVNUM, DDATE, NVL(RANK,'등급정보가 없습니다.') AS RANK
FROM  STREAMER, STREAMER_INFO, VIEWS, DECIDE_INFO
WHERE STREAMER.STREAMER_ID = STREAMER_INFO.STREAMER_ID(+)
AND STREAMER.STREAMER_ID = VIEWS.STREAMER_ID(+)
AND STREAMER.STREAMER_ID = DECIDE_INFO.STREAMER_ID(+)
AND RANK = '&등급'
ORDER BY DDATE DESC, STIME
/

TTITLE OFF
CLEAR COLUMNS